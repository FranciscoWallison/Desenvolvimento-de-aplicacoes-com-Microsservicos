### 1. Qual a Diferen√ßa T√©cnica para assinaturas v1,v2,v3? (O "Porqu√™")

Para entender o impacto, precisamos entender como o Android verifica se o APK √© leg√≠timo.

#### **v1 Signature (JAR Signing) - O M√©todo Antigo**

* **Como funciona:** O Android descompacta o APK (que √© um arquivo ZIP), olha para cada arquivo individualmente (imagens, arquivos `.dex`, recursos) e verifica a assinatura de cada um.
* **O Problema:**
* **Lento:** O celular tem que processar milhares de arquivos na instala√ß√£o.
* **Vulner√°vel (Janus Vulnerability):** Como ele verifica arquivos individuais, √© poss√≠vel injetar arquivos extras no APK (como um arquivo DEX malicioso) sem quebrar a assinatura original em vers√µes antigas do Android. A integridade do "pacote" n√£o √© garantida, apenas a das partes.



#### **v2 Signature (Full APK Signing) - O Padr√£o Atual**

* **Como funciona:** Introduzido no Android 7.0. Ele n√£o olha para os arquivos dentro. Ele cria um hash (resumo criptogr√°fico) do **arquivo bin√°rio inteiro** (o blob do APK).
* **A Vantagem:**
* **Integridade Total:** Se voc√™ mudar 1 bit no arquivo APK (mesmo que seja um metadado no ZIP), a assinatura quebra instantaneamente.
* **Velocidade:** A instala√ß√£o √© muito mais r√°pida, pois o Android s√≥ precisa verificar um hash, n√£o milhares de arquivos.



#### **v3 Signature (Key Rotation) - A Evolu√ß√£o**

* **Como funciona:** Igual √† v2, mas adiciona um bloco que permite a **Rota√ß√£o de Chaves**.
* **A Vantagem:** Se a chave privada da sua empresa for roubada ou vazada, a v3 permite que voc√™ mude para uma chave nova em uma atualiza√ß√£o, dizendo ao Android: "Confie nesta nova chave, ela foi autorizada pela chave antiga". Na v1/v2, se voc√™ perder a chave, perde o app e os usu√°rios (precisa publicar um app novo com pacote diferente).

---

### 2. Impacto para o Time (DevOps e Seguran√ßa)

A mudan√ßa para v2/v3 impacta diretamente o fluxo de trabalho do time de desenvolvimento e seguran√ßa (`cyber-mob`):

#### **A. Mudan√ßa na Pipeline de Build (DevOps)**

No esquema **v1**, a ordem era:

1. Compilar -> 2. Assinar (`jarsigner`) -> 3. Otimizar (`zipalign`).

No esquema **v2/v3**, a ordem **MUDOU OBRIGATORIAMENTE**:

1. Compilar -> 2. Otimizar (`zipalign`) -> 3. Assinar (`apksigner`).

> **Impacto:** Se o time rodar o `zipalign` *depois* de assinar com v2, a assinatura √© destru√≠da e o app n√£o instala. O script de build (`build_all.py`) precisa refletir essa ordem.

#### **B. Seguran√ßa Anti-Tampering (Red Team / RASP)**

Para sua biblioteca `rasp-lib` (que tem prote√ß√µes C++):

* **Com v1:** Um atacante pode tentar modificar o `classes.dex` e reagrupar o APK. Em alguns cen√°rios, a verifica√ß√£o √© mais frouxa.
* **Com v2/v3:** Qualquer tentativa de injetar o `Frida` gadget ou modificar o bin√°rio invalida o APK imediatamente. O atacante √© *obrigado* a reassinar o APK com uma chave pr√≥pria.
* **A√ß√£o:** Sua biblioteca RASP deve verificar a **assinatura do certificado** em tempo de execu√ß√£o. Se o atacante reassinou (porque a v2 o obrigou), seu RASP detecta que a chave n√£o √© a original e fecha o app.

#### **C. Compatibilidade com a Loja (Google Play)**

* A Google Play **exige** v2 ou superior para novos apps.
* Se o time enviar apenas v1, o app ser√° rejeitado ou ter√° avisos de seguran√ßa, al√©m de demorar mais para instalar no celular do usu√°rio final.

---

### 3. Resumo para o seu Relat√≥rio

Voc√™ pode adicionar esta tabela no seu relat√≥rio do portf√≥lio para mostrar dom√≠nio t√©cnico:

| Caracter√≠stica | v1 (Legacy) | v2 (Padr√£o) | v3 (Avan√ßado) |
| --- | --- | --- | --- |
| **O que assina?** | Arquivos individuais dentro do ZIP | O arquivo APK inteiro (bin√°rio) | O arquivo APK + Hist√≥rico de Chaves |
| **Velocidade de Instala√ß√£o** | Lenta (processa tudo) | **Muito R√°pida** | Muito R√°pida |
| **Seguran√ßa (Integridade)** | M√©dia (Vulner√°vel a Janus) | **Alta** (Protege o pacote todo) | **Alta** |
| **Rota√ß√£o de Chaves** | N√£o Suporta | N√£o Suporta | **Suporta** (Vital para recupera√ß√£o) |
| **Ferramenta de Build** | `jarsigner` (Java) | `apksigner` (Android SDK) | `apksigner` |

### üöÄ Recomenda√ß√£o para o Projeto `cyber-mob`

No seu script de build, certifique-se de que est√° usando o **`apksigner`** (n√£o apenas o jarsigner) e habilite ambas as vers√µes para compatibilidade m√°xima:

```bash
# Exemplo de comando que seu script deve gerar
apksigner sign --ks release-key.jks --v1-signing-enabled true --v2-signing-enabled true --v3-signing-enabled true app-release.apk

```

Isso garante que o app rode em Androids muito antigos (v1) mas use a seguran√ßa m√°xima (v2/v3) em aparelhos modernos.